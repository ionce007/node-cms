<!doctype html>
<html lang="en">

	<head>
		<!-- Required meta tags -->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<!-- Bootstrap CSS -->
		<link rel="stylesheet" type="text/css" href="./assets/lib/bootstrap-4.6.0/css/bootstrap.min.css" />
		<link rel="stylesheet" href="./assets/lib/Validform/css/style.css">
		<link rel="stylesheet" type="text/css" href="./assets/css/style.css" />
		<title>标签列表</title>
	</head>

	<body>
		<!-- 导航 -->
		<header></header>
		<div class="container-fluid pt-3">
			<div class="row">
				<!-- 侧边栏 -->
				<div id="left-menu" class="col-2 p-0"></div>
				<!-- 内容 -->
				<div class="col-10">
					<div class="card shadow-sm">
						<div class="card-header d-flex justify-content-between">
							<span>标签列表</span>
							<button data-toggle="modal" data-target="#insertModal" type="button"
								class="btn btn-primary btn-sm">
								<svg class="bi" width="14" height="14" fill="currentColor">
									<use xlink:href="./assets/iconfonts/bootstrap-icons.svg#bookmark-plus" />
								</svg>
								添加新标签
							</button>
						</div>
						<div class="card-body">
							<table class="table table-bordered table-hover mb-0 bg-white">
								<thead class="thead-light">
									<tr>
										<th scope="col">#</th>
										<th scope="col">标签名</th>
										<th scope="col">操作</th>
									</tr>
								</thead>
								<tbody>
									<tr>
										<td>1</td>
										<td>科技</td>
										<td>
											<button type="button" class="btn btn-primary btn-sm">
												<svg class="bi" width="13" height="13" fill="currentColor">
													<use
														xlink:href="./assets/iconfonts/bootstrap-icons.svg#pencil-square" />
												</svg>
												编辑
											</button>
											<button type="button" class="btn btn-danger btn-sm">
												<svg class="bi" width="13" height="13" fill="currentColor">
													<use xlink:href="./assets/iconfonts/bootstrap-icons.svg#trash" />
												</svg>
												删除
											</button>
										</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- 编辑Modal -->
		<div class="modal fade" id="editModal" tabindex="-1" role="dialog">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">编辑标签</h5>
						<button type="button" class="close" data-dismiss="modal">
							<span>&times;</span>
						</button>
					</div>
					<form class="edit-form" method="post" action="/tag/edit">
						<div class="modal-body">
							<div class="form-group row">
								<label class="col-sm-2 col-form-label">标签名称</label>
								<div class="col-sm-10">
									<input type="text" class="form-control" name="name" placeholder="请输入标签名称">
								</div>
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
							<button type="submit" class="btn btn-primary">保存</button>
						</div>
						<!-- 标签id -->
						<input type="hidden" name="id">
					</form>
				</div>
			</div>
		</div>
		<!-- 添加Modal -->
		<div class="modal fade" id="insertModal" tabindex="-1" role="dialog">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">新增标签</h5>
						<button type="button" class="close" data-dismiss="modal">
							<span>&times;</span>
						</button>
					</div>
					<form class="insert-form" method="post" action="/tag/add">
						<div class="modal-body">
							<div class="form-group row">
								<label class="col-sm-2 col-form-label">标签名称</label>
								<div class="col-sm-10">
									<input type="text" class="form-control" name="name" placeholder="请输入标签名称">
								</div>
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
							<button type="submit" class="btn btn-primary">新增</button>
						</div>
					</form>
				</div>
			</div>
		</div>
		<!-- jQuery first, then Popper.js, then Bootstrap JS -->
		<script src="./assets/lib/jQuery/jquery-3.6.0.min.js"></script>
		<script src="./assets/lib/bootstrap-4.6.0/js/bootstrap.min.js"></script>
		<script src="./assets/lib/layer/layer.js"></script>
		<script src="./assets/lib/Validform/js/Validform_v5.3.2_min.js"></script>
		<script src="./assets/js/layout.js"></script>
		<script src="assets/js/public.js"></script>
		<script type="text/javascript">
			$(document).ready(function() {

				function loadList() {
					$.getJSON('/tag/list', function(res) {
						if (res.status) {
							var html = '';
							res.data.forEach(function(item) {
								html += `
									<tr>
										<td>${item.id}</td>
										<td>${item.name}</td>
										<td>
											<button data-id="${item.id}" type="button" class="btn btn-primary btn-sm edit">
												<svg class="bi" width="13" height="13" fill="currentColor">
													<use
														xlink:href="./assets/iconfonts/bootstrap-icons.svg#pencil-square" />
												</svg>
												编辑
											</button>
											<button data-id="${item.id}" type="button" class="btn btn-danger btn-sm remove">
												<svg class="bi" width="13" height="13" fill="currentColor">
													<use xlink:href="./assets/iconfonts/bootstrap-icons.svg#trash" />
												</svg>
												删除
											</button>
										</td>
									</tr>`;
							});
							$('.table tbody').html(html);
						}
					});
				}
				loadList();

				// 删除--事件委托
				$('.table tbody').on('click', '.remove', function() {
					// 获取管理员id
					var id = $(this).data('id');
					var $tr = $(this).parents('tr');
					layer.confirm('确定要删除此标签吗？', function() {
						// 确定
						$.post('/tag/remove', { id: id }, function(res) {
							if (res.status) {
								layer.msg(res.msg);
								// 删除DOM元素
								$tr.remove();
							} else {
								layer.msg(res.msg);
							}
						});
					}, function() {
						// 取消
						layer.msg('取消成功！')
					});
				});

				// 编辑--事件委托
				$('.table tbody').on('click', '.edit', function() {
					var $modal = $('#editModal');
					// 获取数据
					var id = $(this).data('id');
					var name = $(this).parents('tr').find('td').eq(1).text().trim();
					// 赋值表单
					$modal.find('input[name=id]').val(id);
					$modal.find('input[name=name]').val(name);
					// 显示模态框
					$modal.modal('show');
				});
				// 编辑标签
				$('.edit-form').Validform({
					ajaxPost: true,
					tiptype: 4,
					callback: function(res) {
						layer.msg(res.msg);
						if (res.status) {
							$('#editModal').modal('hide');
							// 更新DOM,重新获取列表数据
							loadList();
						}
					}
				});
				// 添加标签
				$('.insert-form').Validform({
					ajaxPost: true,
					tiptype: 4,
					callback: function(res) {
						layer.msg(res.msg);
						if (res.status) {
							$('#insertModal').modal('hide');
							// 更新DOM,重新获取列表数据
							loadList();
						}
					}
				});
			});
		</script>
	</body>

</html>
