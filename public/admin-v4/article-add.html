<!doctype html>
<html lang="en">

	<head>
		<!-- Required meta tags -->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<!-- Bootstrap CSS -->
		<link rel="stylesheet" type="text/css" href="./assets/lib/bootstrap-4.6.0/css/bootstrap.min.css" />
		<link rel="stylesheet" href="./assets/lib/Validform/css/style.css">
		<link rel="stylesheet" type="text/css" href="./assets/css/style.css" />
		<title>发布文章</title>
	</head>

	<body>
		<!-- 导航 -->
		<header></header>
		<div class="container-fluid pt-3">
			<div class="row">
				<!-- 侧边栏 -->
				<div id="left-menu" class="col-2 p-0"></div>
				<!-- 内容 -->
				<div class="col-10">
					<div class="card shadow-sm">
						<div class="card-header">
							发布文章
						</div>
						<div class="card-body">
							<form>
								<div class="form-group row">
									<label class="col-sm-1 col-form-label text-right">标题</label>
									<div class="col-sm-11">
										<input name="" type="text" class="form-control" placeholder="请输入文章标题">
									</div>
								</div>
								<div class="form-group row">
									<label class="col-sm-1 col-form-label text-right">描述</label>
									<div class="col-sm-11">
										<textarea class="form-control" rows="3" placeholder="博客内容的简单摘要"></textarea>
									</div>
								</div>
								<div class="row">
									<label class="col-sm-1 col-form-label text-right">分类</label>
									<div class="form-group col">
										<select name="cate_1st" class="form-control">
										</select>
									</div>
									<div class="form-group col">
										<select name="cate_2nd" class="form-control">
										</select>
									</div>
								</div>
								<div class="form-group row">
									<label class="col-sm-1 col-form-label text-right">主图</label>
									<div class="col-sm-11">
										<img width="200" src="./assets/img/1528961784345.jpg" class="img-thumbnail">
									</div>
								</div>
								<div class="form-group row">
									<label class="col-sm-1 col-form-label text-right">内容</label>
									<div class="col-sm-11">
										<div id="editor"></div>
										<!-- 隐藏表单 -->
										<input type="hidden" name="content" value="" />
									</div>
								</div>
								<div class="form-group row">
									<div class="col-sm-11 offset-sm-1">
										<button type="submit" class="btn btn-primary">发布文章</button>
									</div>
								</div>
							</form>
						</div>

					</div>
				</div>
			</div>

		</div>
		<!-- jQuery first, then Popper.js, then Bootstrap JS -->
		<script src="./assets/lib/jQuery/jquery-3.6.0.min.js"></script>
		<script src="./assets/lib/bootstrap-4.6.0/js/bootstrap.min.js"></script>
		<script src="./assets/lib/layer/layer.js"></script>
		<script src="./assets/lib/Validform/js/Validform_v5.3.2_min.js"></script>
		<script src="./assets/lib/wangEditor/wangEditor.min.js"></script>
		<script src="./assets/js/layout.js"></script>
		<script src="assets/js/public.js"></script>
		<script type="text/javascript">
			// 初始化富文本编辑器
			const E = window.wangEditor
			const editor = new E('#editor')
			// 配置 server 接口地址
			editor.config.uploadImgServer = '/upload/editor/';
			editor.config.uploadFileName = 'file';
			editor.config.uploadImgHeaders = {
				Authorization: `Bearer ${sessionStorage.token}`
			}
			// 监控变化，同步更新到 input
			editor.config.onchange = function(html) {
				$('input[name=content]').val(html)
			}
			
			editor.create();
		</script>
		<script type="text/javascript">
			$(document).ready(function() {
				// 加载一级分类
				$.getJSON('/category/sub', { id: 0 }, function(res) {
					if (res.status) {
						var html = '';
						res.data.forEach(function(item) {
							html += `<option value ="${item.id}">${item.name}</option>`;
						});
						$('select[name=cate_1st]').html(html).trigger('change');
					}
				});
				// 二级联动
				$('select[name=cate_1st]').change(function() {
					// 选中的一级分类的id
					var pid = $(this).val();
					$.getJSON('/category/sub', { id: pid }, function(res) {
						if (res.status) {
							var html = '';
							res.data.forEach(function(item) {
								html += `<option value ="${item.id}">${item.name}</option>`;
							});
							$('select[name=cate_2nd]').html(html);
						}
					});
				});
			});
		</script>
	</body>

</html>
