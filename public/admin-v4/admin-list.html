<!doctype html>
<html lang="en">

	<head>
		<!-- Required meta tags -->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<!-- Bootstrap CSS -->
		<link rel="stylesheet" type="text/css" href="./assets/lib/bootstrap-4.6.0/css/bootstrap.min.css" />
		<link rel="stylesheet" type="text/css" href="./assets/css/style.css" />
		<title>账户列表</title>
	</head>

	<body>
		<!-- 导航 -->
		<header></header>
		<div class="container-fluid pt-3">
			<div class="row">
				<!-- 侧边栏 -->
				<div id="left-menu" class="col-2 p-0"></div>
				<!-- 内容 -->
				<div class="col-10">
					<div class="card bg-primary shadow-sm">
						<div class="card-header text-white">
							账户列表
						</div>
						<table class="table table-bordered table-hover mb-0 bg-white">
							<thead class="thead-light">
								<tr>
									<th scope="col">#</th>
									<th scope="col">用户名</th>
									<th scope="col">姓名</th>
									<th scope="col">性别</th>
									<th scope="col">手机</th>
									<th scope="col">邮箱</th>
									<th scope="col">头像</th>
									<th scope="col">操作</th>
								</tr>
							</thead>
							<tbody>
								<!-- 								<tr>
									<th scope="row">1</th>
									<td>admin</td>
									<td>黄小米</td>
									<td>女</td>
									<td>15863008280</td>
									<td>nn880328@126.com</td>
									<td>
										<img width="60" src="./assets/img/1528961784345.jpg" class="img-thumbnail">
									</td>
									<td>
										<button type="button" class="btn btn-primary btn-sm">
											<svg class="bi" width="13" height="13" fill="currentColor">
												<use
													xlink:href="./assets/iconfonts/bootstrap-icons.svg#pencil-square" />
											</svg>
											编辑
										</button>
										<button type="button" class="btn btn-danger btn-sm">
											<svg class="bi" width="13" height="13" fill="currentColor">
												<use xlink:href="./assets/iconfonts/bootstrap-icons.svg#trash" />
											</svg>
											删除
										</button>
									</td>
								</tr> -->
							</tbody>
						</table>
					</div>
				</div>
			</div>

		</div>
		<!-- jQuery first, then Popper.js, then Bootstrap JS -->
		<script src="./assets/lib/jQuery/jquery-3.6.0.min.js"></script>
		<script src="./assets/lib/bootstrap-4.6.0/js/bootstrap.bundle.min.js"></script>
		<script src="./assets/lib/layer/layer.js"></script>
		<script src="./assets/lib/Validform/js/Validform_v5.3.2_min.js"></script>
		<script src="./assets/js/layout.js"></script>
		<script src="./assets/js/public.js"></script>
		<script type="text/javascript">
			$(document).ready(function() {
				$.getJSON('/admin/list', function(res) {
					if (res.status) {
						var html = '';
						res.data.forEach(function(item) {
							html += `
							<tr>
								<td>${item.id}</td>
								<td>${item.username}</td>
								<td>${item.fullname}</td>
								<td>${item.sex}</td>
								<td>${item.tel}</td>
								<td>${item.email}</td>
								<td>
									<img width="60" src="${item.avatar}" class="img-thumbnail">
								</td>
								<td>
									<a href="./admin-edit.html?id=${item.id}" class="d-inline-block">
										<button type="button" class="btn btn-primary btn-sm edit">
											<svg class="bi" width="13" height="13" fill="currentColor">
												<use
													xlink:href="./assets/iconfonts/bootstrap-icons.svg#pencil-square" />
											</svg>
											编辑
										</button>
									</a>
									<button data-id="${item.id}" type="button" class="btn btn-danger btn-sm remove">
										<svg class="bi" width="13" height="13" fill="currentColor">
											<use xlink:href="./assets/iconfonts/bootstrap-icons.svg#trash" />
										</svg>
										删除
									</button>
								</td>
							</tr>`
						});
						$('.table tbody').html(html);
					}
				});
				// 事件委托
				$('.table tbody').on('click', '.remove', function() {
					// 获取管理员id
					var id = $(this).data('id');
					var $tr = $(this).parents('tr');
					layer.confirm('确定要删除此账户吗？', function() {
						// 确定
						$.post('/admin/remove', { id: id }, function(res) {
							if (res.status) {
								layer.msg(res.msg);
								// 删除DOM元素
								$tr.remove();
							} else {
								layer.msg(res.msg);
							}
						});
					}, function() {
						// 取消
						layer.msg('取消成功！')
					})
				});

			});
		</script>


	</body>

</html>
