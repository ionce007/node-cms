<!doctype html>
<html lang="en">

<head>
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<!-- Bootstrap CSS -->
	<link rel="stylesheet" type="text/css" href="./assets/lib/bootstrap/css/bootstrap.min.css" />
	<link rel="stylesheet" href="./assets/iconfonts/bootstrap-icons.css">
	<link rel="stylesheet" type="text/css" href="./assets/css/style.css" />
	<title>管理员列表</title>
</head>

<body>
	<!-- 导航 -->
	<header></header>
	<div class="container-fluid pt-3">
		<div class="row">
			<!-- 侧边栏 -->
			<div id="left-menu" class="col-2 p-0"></div>
			<!-- 内容 -->
			<div class="col-10">
				<div class="card shadow-sm">
					<div class="card-header">
						管理员列表
					</div>
					<div class="card-body">
						<table class="table table-bordered table-hover mb-0 bg-white">
							<thead class="table-light">
								<tr>
									<th scope="col">#</th>
									<th scope="col">用户名</th>
									<th scope="col">姓名</th>
									<th scope="col">性别</th>
									<th scope="col">手机</th>
									<th scope="col">邮箱</th>
									<th scope="col">角色</th>
									<th scope="col">头像</th>
									<th scope="col">操作</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<th scope="row">1</th>
									<td>admin</td>
									<td>黄小米</td>
									<td>女</td>
									<td>15863008280</td>
									<td>nn880328@126.com</td>
									<td>管理员</td>
									<td>
										<img width="60" src="./assets/img/avatar.jpg" class="img-thumbnail">
									</td>
									<td>
										<button type="button" class="btn btn-outline-primary btn-sm">
											<i class="bi bi-pencil-square"></i>
											编辑
										</button>
										<button type="button" class="btn btn-outline-danger btn-sm">
											<i class="bi bi-trash"></i>
											删除
										</button>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>

	</div>
	<!-- jQuery first, then Popper.js, then Bootstrap JS -->
	<script src="./assets/lib/jQuery/jquery-3.6.0.min.js"></script>
	<script src="./assets/lib/bootstrap/js/bootstrap.min.js"></script>
	<script src="./assets/lib/layer/layer.js"></script>
	<script src="./assets/lib/Validform/js/Validform_v5.3.2_min.js"></script>
	<!-- 公共layout -->
	<script src="./assets/js/layout.js"></script>
	<!-- 身份认证 -->
	<script src="./assets/js/auth.js"></script>
	<script>
		// 获取列表
		$.getJSON('/admin/list', function (res) {
			if (res.status) {
				var html = '';
				res.data.forEach(function (item, index) {
					html += `<tr>
									<th scope="row">${item.id}</th>
									<td>${item.username}</td>
									<td>${item.fullname}</td>
									<td>${item.sex}</td>
									<td>${item.tel}</td>
									<td>${item.email}</td>
									<td>${item.role_name}</td>
									<td>
										<img width="60" src="${item.avatar}" class="img-thumbnail">
									</td>
									<td>
										<a href="./admin-edit.html?id=${item.id}" class="btn btn-outline-primary btn-sm">
											<i class="bi bi-pencil-square"></i>
											编辑
										</a>
										<button data-id="${item.id}" type="button" class="btn btn-outline-danger btn-sm remove">
											<i class="bi bi-trash"></i>
											删除
										</button>
									</td>
								</tr>`
				});
				$('.table tbody').html(html);
			}
		});
		// 删除操作---事件委托
		$('.table').on('click', '.remove', function () {
			// 提取id
			var id = $(this).data('id');
			var $tr = $(this).parents('tr');

			layer.confirm('确定要删除此账户吗？', function yes() {
				$.post('/admin/remove', { id: id }, function (res) {
					if (res.status) {
						// 删除DOM
						$tr.remove();
						// 提示信息
						layer.msg(res.msg, { icon: 1 });
					} else {
						layer.msg(res.msg, { icon: 5 });
					}
				});
			}, function cancel() {
				layer.msg('取消成功！')
			});
		});
	</script>
</body>

</html>