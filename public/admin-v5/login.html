<!doctype html>
<html lang="en">

<head>
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<!-- Bootstrap CSS -->
	<link rel="stylesheet" type="text/css" href="./assets/lib/bootstrap/css/bootstrap.min.css" />
	<!-- 表单验证 -->
	<link rel="stylesheet" href="./assets/lib/Validform/css/style.css">

	<link rel="stylesheet" type="text/css" href="./assets/css/style.css" />
	<title>登录</title>
</head>

<body>
	<div class="bg">
		<div class="container">
			<div class="card form-panel bg-primary position-absolute top-50 translate-middle-y">
				<div class="card-header text-white">
					登录
				</div>
				<div class="card-body bg-white">
					<form id="form" action="/admin/login">
						<div class="row mb-4">
							<label class="col-sm-2 col-form-label">账户</label>
							<div class="col-sm-10">
								<input name="username" datatype="s3-15" errormsg="账户名至少3个字符,最多15个字符！" type="text"
									class="form-control">
							</div>
						</div>
						<div class="row mb-4">
							<label class="col-sm-2 col-form-label">密码</label>
							<div class="col-sm-10">
								<input name="password" datatype="n3-20" errormsg="密码至少3个数字,最多20个数字！" type="password"
									class="form-control">
							</div>
						</div>
						<div class="row">
							<div class="col offset-2">
								<button type="submit" class="btn btn-primary btn-block">登录</button>
							</div>
						</div>

					</form>
				</div>
				<div class="card-footer py-3 bg-white d-flex justify-content-between">
					<a href="register.html" class="text-secondary text-decoration-none">注册账户</a>
					<a href="#" class="text-secondary text-decoration-none">忘记密码？</a>
				</div>
			</div>
		</div>
	</div>
	<!-- jQuery first, then Popper.js, then Bootstrap JS -->
	<script src="./assets/lib/jQuery/jquery-3.6.0.min.js"></script>
	<script src="./assets/lib/bootstrap/js/bootstrap.bundle.min.js"></script>
	<script src="./assets//lib//Validform/js/Validform_v5.3.2_min.js"></script>
	<script src="./assets/lib/layer/layer.js"></script>
	<script>
		$('#form').Validform({
			ajaxPost: true,
			tiptype: function (msg, o, cssctl) {
				//o:{obj:*,type:*,curform:*},
				//obj指向的是当前验证的表单元素（或表单对象，验证全部验证通过，提交表单时o.obj为该表单对象），
				//type指示提示的状态，值为1、2、3、4， 1：正在检测/提交数据，2：通过验证，3：验证失败，4：提示ignore状态, 
				//curform为当前form对象;

				// 检测是否 radio || checkbox
				var isCheck = o.obj.is(':radio') || o.obj.is(':checkbox');
				// 移除所有状态class
				if (isCheck) {
					var name = o.obj.prop('name');
					var $checkGroup = o.curform.find('[name=' + name + ']');
					$checkGroup.removeClass('is-valid is-invalid');
				} else {
					o.obj.removeClass('is-valid is-invalid');
				}
				switch (o.type) {
					case 1:
						break;
					case 2:
						if (isCheck) {
							$checkGroup.addClass('is-valid')
						} else {
							o.obj.addClass('is-valid');
						}
						break;
					case 3:
						if (isCheck) {
							$checkGroup.addClass('is-invalid');
							// 提示信息是否存在？
							var isExist = o.obj.parents('.form-check').next('.invalid-feedback').length > 0;
							if (isExist) {
								o.obj.parents('.form-check').next('.invalid-feedback').text(msg);
							} else {
								var $feedback = $('<div class="invalid-feedback">' + msg + '</div>');
								o.obj.parents('.form-check').after($feedback);
							}
							return;
						}
						// 其他表单元素，添加无效状态
						o.obj.addClass('is-invalid');
						// 提示信息是否存在？
						var isExist = o.obj.next('.invalid-feedback').length > 0;
						if (isExist) {
							o.obj.next('.invalid-feedback').text(msg);
						} else {
							var $feedback = $('<div class="invalid-feedback">' + msg + '</div>');
							o.obj.after($feedback);
						}
						break;
					case 4:
						break;
					default:
						break;
				}
			},
			callback: function (res) {
				if (res.status) {
					// 缓存数据
					sessionStorage.token = res.data.token;
					sessionStorage.id = res.data.id;
					sessionStorage.role = res.data.role;
					// 跳转页面
					location.assign('./admin-list.html');
					// 提示信息
					layer.msg(res.msg, { icon: 1 });
				} else {
					layer.msg(res.msg, { icon: 5 });
				}
			}
		});
	</script>
</body>

</html>